{
    "collab_server" : "",
    "contents" : "#######################################################################################\n#### This cleans the 2016 polling data from FiveThirtyEight\n#### http://projects.fivethirtyeight.com/general-model/president_general_polls_2016.csv\n#### Author: Kevin Soo\n#######################################################################################\n\n# load libraries\nlibrary(tidyverse)\nlibrary(stringr)\nlibrary(rvest)\n\n# load data\npolls2016 <- read.csv(\"president_general_polls_2016.csv\")\n\n# set types\npolls2016$forecastdate <- as.Date(polls2016$forecastdate, format=\"%m/%d/%y\")\npolls2016$startdate <- as.Date(polls2016$startdate, format=\"%m/%d/%y\")\npolls2016$enddate <- as.Date(polls2016$enddate, format=\"%m/%d/%y\")\npolls2016$createddate <- as.Date(polls2016$createddate, format=\"%m/%d/%y\")\n\n# get relevant data (only trump and clinton)\nid <- 1:nrow(polls2016)\npolls2016 <- polls2016 %>% filter(type==\"polls-only\") %>% \n    select(state:rawpoll_trump, adjpoll_clinton, adjpoll_trump, poll_id:question_id)\npolls2016 <- data.frame(id, polls2016)\n\n# long format\npolls2016 <- polls2016 %>% gather(poll, level, rawpoll_clinton:adjpoll_trump) %>% arrange(id, poll)\npolls2016$candidate <- NA\npolls2016$type <- NA\nfor (i in 1:nrow(polls2016)) { \n    tmp <- str_split(polls2016$poll[i], \"_\")[[1]]\n    polls2016$candidate[i] <- tmp[2]\n    polls2016$type[i] <- tmp[1]\n}\n\n# final checks\npolls <- polls2016 %>% select(id:poll_wt, type, candidate, level)\npolls$type <- ifelse(polls$type==\"adjpoll\", \"Adjusted\", \"Raw\")\npolls$candidate <- ifelse(polls$candidate==\"clinton\", \"Clinton\", \"Trump\")\npolls$type <- as.factor(polls$type)\npolls$candidate <- as.factor(polls$candidate)\ncolnames(polls) <- c(\"ID\", \"State\", \"Start\", \"End\", \"Pollster\", \"Grade\", \"SampleSize\", \"Population\", \"PollWeight\", \"Type\", \"Candidate\", \"Level\")\n\n# save data frame\nsave(polls, file=\"polls.Rda\")",
    "created" : 1479177232980.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3122561765",
    "id" : "2723A5D8",
    "lastKnownWriteTime" : 1479177403,
    "last_content_update" : 1479177403939,
    "path" : "~/Box Sync/Personal/polls/clean_polls.R",
    "project_path" : "clean_polls.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}